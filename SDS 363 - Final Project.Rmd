---
title: "SDS 363 - Final Project"
author: "Neehaar Gandhi, David Liu, Josh Brooks"
date: "4/29/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Introduction
This project analyzes the data that drives the 2018 edition of the officially licensed Fédération Internationale de Football Association (International Federation of Association Football) video game, titled FIFA 18, produced by Electronic Arts (EA). Association football (soccer) is by far the most popular sport in the world, so it should come as no surprise that the game has became something of a cultural icon. To date, the FIFA franchise is the sixth-best selling video game series in history, with its popularity likely to continue rising. A new version of the game is released once per year, making the 2018 edition of the game the twenty-fifth installment. 

Within the electronic entertainment industry, sports video games present a unique, data-driven challenge. Gamers want to be titillated and drawn in, while rapid sports fans simply will never tolerate misrepresentation of their favorite players. This tension -- between manufacturing a maximally effective fictitious world and satisfying players’ wish to play with real people -- leads to a wealth of data-driven challenges. This is the central consideration that underscores our analysis. We will use the game’s player rating data, which is described in detail in the following section, to answer questions about the relationships between soccer player attributes.

#Design and Primary Questions
One area of interest for us is understanding better how EA producers ultimately come to their “Overall” player ratings, which is often markedly higher than the average of their other skill categories. This leads us to believe that there is an element of subjectivity in determining overall player scores; EA sports determines that some players have the x-factor needed to boost their overall scores, while others do not. Thus, a principal question for us is: *What sets of variables correspond with higher overall scores, and can we use those variables to tell a story about what an ‘x-factor’ might be?* To answer this we will use factor analysis. In so doing we hope we will be able to find a latent factor that might tell a story about what makes players valuable on the field. 

Further, we seek to look for patterns of players within particular position groups. *Within broad positional categories -- back, midfielder, forward -- can we see discernable subgroups of players?* Again, we would certainly expect to see this, given subjective understandings of soccer tactics. Using k-means as a clustering technique, we hope to create a readable picture of positional subgroups.

Finally, we want to look at the interactions between FIFA players’ nationalities and their skills in various areas. In the international soccer community, it is very common to talk about geographic regions as very different. For instance, it has become accepted wisdom to say that Latin American teams play a more skillful, less team-oriented style, while European teams play with more precision and less individual skill. We hope to see whether the data bear this out. In this vein, our third question for analysis will be: *Do different country groups create players that are differently abled in particular facets of the game?* To test this we will use MANOVA and attempt to establish differences in ability means between various nationality groups.

#Data
```{r}
#include relevant libraries for project
library(aplpack)
library(fpc)
library(cluster)
library(ape)
library(ggplot2)
library(DBItest)
library(tidyverse)  
library(factoextra)
library(psych)
library(rela)
library(corrplot)
library(PerformanceAnalytics)

PD <- read.csv("data.csv", header=TRUE, stringsAsFactors = FALSE)
#isolate only complete cases
PD <- PD[complete.cases(PD),]
PD[,c(4, 6, 7, 9, 17, 18, 19:57)]
PD[,4] <- as.numeric(PD[,4])
PD[,6] <- as.numeric(PD[,6])
PD[,7] <- as.numeric(PD[,7])
PD[,9] <- as.numeric(PD[,9])
PD[,17] <- as.numeric(PD[,17])
PD[,18] <- as.numeric(PD[,18])
```
The dataset is quite large, as a result of the game’s intention of accurately representing every male professional soccer player in the world. While the video game surely requires an even larger ocean of data to operate, we will concern ourselves only with the player rating data -- those data that describe the qualities of individual athletes and their particular traits and skills. 
There are a few broad categories of data in the set. The first type of variable is made up of the information that describes a player and his location. These include physical traits like height and weight, as well as the club for which the player plays professionally, the country for which the player plays in international competition, the player’s wage per game-week, and the like. All of this information is taken directly from publicly available postings by the players’ clubs. Wage is rounded to the nearest thousand, which could change the data somewhat at lower numbers. 
The second, and ultimately the most significant, type of variable in the set comprises ratings for various in-game skills and actions on a 100 point scale. The full list has more than thirty predictors, which will be detailed below. Among them are skilled related to playing offense, playing defense, passing, athleticism, and everyone else that one must do on a soccer field. Some examples are: “Ball Control” (ability to keep possession of the ball and place it in a favorable position for future actions), “Finishing” (generalized fast-twitch ability to accurately kick the ball into the goal after receiving a pass), “Marking” (ability to successfully keep with a player while playing defense, and prevent him from receiving the ball), and “Agility” (a general measure of ability to move quickly over short distances and control one’s body through space). 
These skill ratings are, of course, highly subjective. They do not appear out of thin air; they must be created and compiled by human raters. EA are upfront about their process. They delegate the much of the task of watching and evaluating to a network of over 9000 “data reviewers”, made up of professionals (coaches) and amateurs (qualified fans). The material from the reviewers comes to a group of a few-hundred editors, who compile the data into the rating categories listed below. With this in mind, we can think of these ratings as the results of a large survey, in which soccer fanatics are asked to watch a great deal of game film and give answers to questions about player ability. This is not exactly true -- EA’s producers and editors tweak the data as they see fit, and the sampling of data reviewers is surely not perfectly random -- but thinking of it this way provides a general picture.
The third group of predictors is smaller and generally less useful. It is made up of semi-categorical predictors (categorical skill ratings with five levels). These include “Skill Moves” and “International Reputation”. We will largely ignore these in our analysis -- they are less about soccer, and more about game mechanics. Skill moves is a good example of this category. From 1 to 5, as players go to up higher thresholds of skill rating, they gain the ability to carry out particular in-game actions.

[insert variables below]

#Descriptive plots, summary statistics

#Multivariate Analysis and Discussion of Results

*Factor Analysis*
In conducting factor analysis for our data, we first had to determine the suitability by computing KMO (Kaiser-Meyer-Olkin). Further, a test such as Principal Component Analysis (PCA) must be conducted to determine a number of latent factors that we are looking for, and as such, we will compute PCA on the covariance matrix because the variable scales we utilized are similar (ranging from 0-100). 
The code has been muted for the sake of space in the final report.
```{r}
#subset data that we will use for factor analysis
data <- PD[,c(4, 6, 7, 9, 17, 18, 19:57)]
head(data)
```

```{r}
#compute the correlation matrix between all indicators
data[,5] <- as.numeric(data[,5])
#partition into thirds so that correlation plots are more readible
data1 <- data[,1:length(data)/3]
data2 <- data[,(length(data)/3):(2*(length(data)/3))]
data3 <- data[,(2*(length(data)/3)):length(data)]
corrplot(cor(data1),method = "ellipse", order="hclust", tl.col = "black", tl.cex=.8)
corrplot(cor(data2),method = "ellipse", order="hclust", tl.col = "black", tl.cex=.8)
corrplot(cor(data3),method = "ellipse", order="hclust", tl.col = "black", tl.cex=.8)

#chart.Correlation(data1, histogram=TRUE, pch=19)
#chart.Correlation(data2, histogram=TRUE, pch=19)
#chart.Correlation(data3, histogram=TRUE, pch=19)
```
[comment on relationships that we do/don't observe]

```{r}
#KMO
datamat <- data.matrix(data1)
output1 <- paf(datamat, eigcrit=1, convcrit=.001)
print(output1$KMO)
summary(output1)

#Using PCA
fit <- princomp(data, cor=FALSE)
summary(fit)
loadings(fit)

#eigenvalue > 1
print(summary(fit),digits=2,loadings=fit$loadings,cutoff=0)
#all 14 components have a stdev and variance (eigenvalue) of greater than one, perhaps use a different metric to determine number of latent factors. 

#scree plot
plot(fit, type="lines", main="Scree Plot of FIFA Data",col="red",lwd=2,pch=19,cex=1.2)
#seems to be an elbow at the 4th or 5th component
```

Below is the actual Factor Analysis Test
```{r}
fact_ml <- fa(data, nfactors=4, rotation="none", fm="ml")
fact_ml
```

Loading plot for first two factors
```{r}
plot(fact_ml$loadings, pch=18, col='red')
abline(h=0)
abline(v=0)
text(fact_ml$loadings, labels=names(data),cex=0.8)
```

Correlation matrix analysis
```{r}
#get reproduced correlation matrix
repro_ml <- fact_ml$loadings%*%t(fact_ml$loadings)
#residual correlation matrix
resid_ml <- cor(data)-repro_ml
round(resid_ml,2)

#get root-mean squared residuals - already provided in output actually
len <- length(resid_ml[upper.tri(resid_ml)])
RMSR_ml <- sqrt(sum(resid_ml[upper.tri(resid_ml)]^2)/len)
RMSR_ml

#get proportion of residuals greater than 0.05 in absolute value
sum(rep(1,len)[abs(resid_ml[upper.tri(resid_ml)])>0.05])/len
```
[insert analysis here]


*K-Means*
```{r}
#make a new matrix for K-Mean Analysis
KPD <- PD

KPD[,c("X", "ID", "Name", "Nationality", "Club", "PreferredFoot", "BodyType", "Position", "InternationalReputatiton", "WeakFoot", "SkillMoves")] <- list(NULL)

KPD
KPD[,7] <- as.numeric(KPD[,7])
#sapply(1:ncol(PD), function(a) {class(PD[,a])})

KPD <- scale(KPD)
```
[insert analysis here]

*MANOVA*
```{r}

```
[insert analysis here]

#Conclusions and Discussion

#Points for further analysis
