copy / paste this line and below ----   
---
title: "Homework 5 MANOVA"
author: "Neehaar Gandhi, David Liu, Josh Brooks"
date: "4/7/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

####Load Packages
```{r}
library(MASS)
library(DiscriMiner)
library(klaR)
```

####Define Data
```{r}
#read data
PD <- read.csv("data.csv", header=TRUE, stringsAsFactors = FALSE)

#isolate only complete cases
PD <- PD[complete.cases(PD),]

#choose only the data that will be useful and relevant for this MANOVA
data <- PD[,c("BodyType","PreferredFoot","BallControl","HeadingAccuracy","CM","ST","Overall")]

#there are a few players who, oddly, have their own names as their body type. we need to remove these players, and instead keep only the three body types below. subsetting and binding surely isn't the ideal way to do this, but i think it works fine.
data1 <- subset(data, BodyType == "Normal")
data2 <- subset(data, BodyType == "Stocky")
data3 <- subset(data, BodyType == "Lean")

newdata <- rbind(data1, data2, data3)
```



####1. Look at interaction plots and discuss what you see. 

#make an interaction plots
```{r}

#par(mfrow=c(2,2))

interaction.plot(newdata$BodyType,newdata$PreferredFoot,newdata$Overall,lwd=3,col=c("red","blue","black"),trace.label = "Preferred Foot",xlab="Body Type",ylab="Mean of Overall",main="Interaction Plot for Overall Rating", legend=FALSE)
legend("topleft", c("Left","Right"),bty="n",lty=c(2,1),lwd=3,col=c("red","blue"), title="Preferred Foot",inset = 0, cex=.8,y.intersp
=.7, horiz = TRUE)

interaction.plot(newdata$BodyType,newdata$PreferredFoot,newdata$BallControl,lwd=3,col=c("red","blue","black"),trace.label="Preferred Foot",xlab="Body Type",ylab="Mean of Ball Control",main="Interaction Plot for Ball Control Rating",legend=FALSE)
legend("topleft", c("Left","Right"),bty="n",lty=c(2,1),lwd=3,col=c("red","blue"), title="Preferred Foot",inset = 0, cex=.8,y.intersp
=.7, horiz = TRUE)

interaction.plot(newdata$BodyType,newdata$PreferredFoot,newdata$ST,lwd=3,col=c("red","blue","black"),trace.label="Preferred Foot",xlab="Body Type",ylab="Mean of ST",main="Interaction Plot for Striking Skill",legend=FALSE)
legend("topleft", c("Left","Right"),bty="n",lty=c(2,1),lwd=3,col=c("red","blue"), title="Preferred Foot",inset = 0, cex=.8,y.intersp
=.7, horiz = TRUE)
```

*These interaction plots are very interesting.* 

*Firstly, we must be sure to address differences in the data. There are only 4000 left-footed observations, while there are 12116 right-footed players. Both are sizable samples, but the left-footed sample is nevertheless one-third as big. In a similar vein, 1004 players are listed as "Stocky", 5969 as "Lean", and the remaining 9143 as "Normal". Again, however, the group memberships are fairly large, and we remain comfortable using MANOVA in our analysis.*  

*None of the three plots is parallel. In all three, left and right footed players seem to be affected in differing amounts by changes in body type. Multivariate means for stocky left and right footed players seem particularly different. We hope to generate some significant findings with MANOVA.*  


####2. Run Two-Way MANOVA for these two categorical factors. Discuss your results, both univariate and multivariate.

#fit linear model
```{r}
#note that columns three through seven are our continuous variables. we will look at the same three as above: overall rating, ball control, and striking ability.
mod1 <- manova(as.matrix(newdata[,c(3,6:7)]) ~ newdata$BodyType + newdata$PreferredFoot + newdata$BodyType*newdata$PreferredFoot) 
```

#get univariate results
```{r}
summary.aov(mod1)
```
*The univariate results suggest that the effect BodyType level is significant for all three response variables. PreferredFoot is highly significant for both overall rating and ball control, but we cannot reject the null for striking ability. The interaction of the two categorical predictors is only significant for the striking ability variable (ST).*  


#get multivariate results
```{r}
summary.manova(mod1)
summary.manova(mod1, test="Wilks")
```
*The two-way MANOVA shows significant multivariate effects for both independent variables. The Pillai's Trace values and all quite small, and the Wilks' Lambda values are all quite large. We cannot reject the null hypothesis for the interaction term, due to its large p-value.*


3. Perform (multivariate) contrasts to compare levels of a particular factor or combinations of factors. Discuss your results **CONSIDER IT MAJOR EXTRA CREDIT IF YOU GET THIS TO WORK IN R, OTHERWISE WE NEED TO DO UNIVARIATE CONTRASTS**

4. If applicable, add a continuous variable to your model and fit as a multiple-response generalized linear model. Before you fit the model, make some plots to see if there are linear relationships between your covariates and your responses. 

#plot to see whether there exist linear relationships between covariates and your reponses
```{r}
#THIS IS PROVING PROBLEMATIC 
plot(newdata$CM, newdata$Overall, main = 'Overall ~ CM')
plot(newdata$HeadingAccuracy, newdata$Overall, main = 'Overall ~ HeadingAccuracy')
```

#fit linear model
```{r}
#NEEHAAR EDIT: ADDED IN CM AND HEADING ACCURACY COVARIATES AS PREDICTORS OF OVERALL RATING, BALL CONTROL, AND STRIKING ABILITY 
mod2 <- lm(as.matrix(newdata[,c(3,6:7)]) ~ newdata$BodyType*newdata$PreferredFoot + newdata$CM + newdata$HeadingAccuracy)
```

#get univariate results
```{r}
summary.lm(mod2)
```
*The univariate results show that the overall model is statistically significant, thus the beta coeffecients are not equal to zero (i.e. there exists a relationship between BallControl, ST, and Overall and CM, HeadingAccuracy, and the interaction of BodyType and PreferredFoot)*


5. Check model assumptions by making a chi-square quantile plot of the residuals. Modify your model as appropriate based on your findings.

```{r}
source("http://www.reuningscherer.net/STAT660/R/CSQPlot.r.txt")
CSQPlot(mod1$residuals, label="MANOVA Residuals")
#maybe this should be changed to the GLM residuals instead of MANOVA? possibly just add GLM results?
CSQPlot(mod2$residuals, label="MANOVA Residuals")
```
*The residuals look close to normal, but certainly not perfectly close. I DONT KNOW HOW TO MAKE THE MODEL BETTER IN LIGHT OF THIS.*
